apiVersion: v1
kind: Secret
metadata:
  name: mysql-credentials
type: Opaque
data:
  username: YWtpZg== ## user name of mysql user -> base64 encoded
  password: cGFzc3dvcmQ= ## password -> base64 encoded
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: cronjob-backup
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: nfs-client
  resources:
    requests:
      storage: 1Gi

---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: mysqldump-cronjob
spec:
  schedule: "* * * * *" ##how often will it execute??
  jobTemplate:
    spec:
      template:
        metadata:
          name: mysqldump-job
        spec:
          containers:
          - name: backup-mysql-client
            image: mysql
            command: ["bash", "-c"]
            args:
              - |
                mysqldump --triggers --routines --events --no-tablespaces -u$MYSQL_USERNAME -p$MYSQL_PASSWORD -hmysql-read -P3306 --default-character-set=utf8 --all-databases > /tmp/$(date +\%Y\%m\%d_\%H\%M\%S).sql
            ##change the --all-databases to specific database we want to backup!
            ##change svc name to the reader cluster ip
            volumeMounts:
            - name: cronjob-backup
              mountPath: /tmp #inside container location
            env:
              - name: MYSQL_USERNAME
                valueFrom:
                  secretKeyRef:
                    name: mysql-credentials
                    key: username
              - name: MYSQL_PASSWORD
                valueFrom:
                  secretKeyRef:
                    name: mysql-credentials
                    key: password  
          restartPolicy: Never
          volumes:
            - name: cronjob-backup
              persistentVolumeClaim:
                claimName: cronjob-backup